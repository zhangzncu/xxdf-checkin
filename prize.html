<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¥–å“ - åšæŒå¾ˆé…·</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <!-- æ¿€åŠ±è¯­ -->
    <div class="card welcome-card">
      <div class="welcome-text">å­¦ä¹ å¾ˆè‹¦</div>
      <div class="welcome-text cool-text">åšæŒå¾ˆé…·</div>
    </div>
    
    <!-- æ˜Ÿæ˜Ÿæ€»æ•° -->
    <div class="card stars-card">
      <div class="stars-label">å½“å‰æ˜Ÿæ˜Ÿ</div>
      <div class="stars-count" id="totalStars">0</div>
      <div class="stars">
        <span>â­</span><span>â­</span><span>â­</span>
      </div>
    </div>
    
    <!-- å¥–å“åˆ—è¡¨ -->
    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <span class="title" style="margin-bottom: 0;">å¥–å“åˆ—è¡¨</span>
        <button class="btn-manage" onclick="showAddPrizeModal()">æ·»åŠ å¥–å“</button>
      </div>
      <div class="prizes-list" id="prizesList">
        <div class="empty-record">æš‚æ— å¥–å“</div>
      </div>
    </div>
    
    <!-- åº•éƒ¨å¯¼èˆª -->
    <div class="tab-bar">
      <a href="index.html" class="tab-item">
        <span class="tab-icon">ğŸ </span>
        <span class="tab-text">é¦–é¡µ</span>
      </a>
      <a href="check.html" class="tab-item">
        <span class="tab-icon">âœ…</span>
        <span class="tab-text">æ‰“å¡</span>
      </a>
      <a href="record.html" class="tab-item">
        <span class="tab-icon">ğŸ“‹</span>
        <span class="tab-text">è®°å½•</span>
      </a>
      <a href="prize.html" class="tab-item active">
        <span class="tab-icon">ğŸ</span>
        <span class="tab-text">å¥–å“</span>
      </a>
      <a href="setting.html" class="tab-item">
        <span class="tab-icon">âš™ï¸</span>
        <span class="tab-text">è®¾ç½®</span>
      </a>
    </div>
  </div>
  
  <!-- æ·»åŠ å¥–å“å¼¹çª— -->
  <div class="modal" id="addPrizeModal" style="display: none;">
    <div class="modal-content">
      <div class="modal-title">æ·»åŠ å¥–å“</div>
      <div class="form-group">
        <label class="form-label">å¥–å“åç§°</label>
        <input type="text" class="form-input" id="prizeNameInput" placeholder="è¯·è¾“å…¥å¥–å“åç§°">
      </div>
      <div class="form-group">
        <label class="form-label">æ‰€éœ€æ˜Ÿæ˜Ÿ</label>
        <input type="number" class="form-input" id="prizeCostInput" placeholder="è¯·è¾“å…¥æ‰€éœ€æ˜Ÿæ˜Ÿæ•°é‡">
      </div>
      <div class="modal-actions">
        <button class="btn-secondary" onclick="closeAddPrizeModal()">å–æ¶ˆ</button>
        <button class="btn-primary" onclick="submitAddPrize()">æ·»åŠ </button>
      </div>
    </div>
  </div>
  
  <!-- å…‘æ¢ç¡®è®¤å¼¹çª— -->
  <div class="modal" id="exchangeModal" style="display: none;">
    <div class="modal-content">
      <div class="modal-title">å…‘æ¢ç¡®è®¤</div>
      <p style="text-align: center; margin-bottom: 15px;">ç¡®å®šè¦å…‘æ¢ "<span id="exchangePrizeName"></span>" å—ï¼Ÿ</p>
      <p style="text-align: center; margin-bottom: 20px; color: #f44336; font-weight: bold;">éœ€è¦ <span id="exchangeCost"></span> é¢—æ˜Ÿæ˜Ÿ</p>
      <div class="modal-actions">
        <button class="btn-secondary" onclick="closeExchangeModal()">å–æ¶ˆ</button>
        <button class="btn-primary" onclick="confirmExchange()">ç¡®è®¤å…‘æ¢</button>
      </div>
    </div>
  </div>
  
  <!-- åˆ é™¤ç¡®è®¤å¼¹çª— -->
  <div class="modal" id="deleteModal" style="display: none;">
    <div class="modal-content">
      <div class="modal-title">åˆ é™¤ç¡®è®¤</div>
      <p style="text-align: center; margin-bottom: 20px;">ç¡®å®šè¦åˆ é™¤ "<span id="deletePrizeName"></span>" å—ï¼Ÿ</p>
      <div class="modal-actions">
        <button class="btn-secondary" onclick="closeDeleteModal()">å–æ¶ˆ</button>
        <button class="btn-primary" onclick="confirmDelete()">ç¡®è®¤åˆ é™¤</button>
      </div>
    </div>
  </div>
  
  <style>
    .btn-manage { padding: 8px 16px; background-color: #4CAF50; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer; }
    .prizes-list { max-height: 400px; overflow-y: auto; }
    .prize-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f0f0f0; }
    .prize-item:last-child { border-bottom: none; }
    .prize-name { font-size: 16px; font-weight: bold; color: #333; }
    .prize-cost { display: flex; align-items: center; gap: 5px; }
    .prize-cost .cost-label { font-size: 12px; color: #999; }
    .prize-cost .cost-stars { font-size: 18px; font-weight: bold; color: #4CAF50; }
    .exchange-btn { padding: 8px 16px; background-color: #4CAF50; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer; margin-left: 15px; }
    .exchange-btn:disabled { background-color: #ccc; cursor: not-allowed; }
    .delete-btn { padding: 8px 16px; background-color: #f44336; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer; }
    .form-group { margin-bottom: 15px; }
    .form-label { display: block; font-size: 14px; color: #666; margin-bottom: 8px; }
    .form-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
  </style>
  
  <script src="wx-api.js"></script>
  <script>
    let prizes = [];
    let currentPrize = null;
    let deletePrizeId = 0;
    
    document.addEventListener('DOMContentLoaded', function() {
      loadPrizes();
    });
    
    function loadPrizes() {
      // æ›´æ–°æ˜Ÿæ˜Ÿæ˜¾ç¤º
      const totalStars = wx.getStorageSync('totalStars') || 0;
      document.getElementById('totalStars').textContent = totalStars;
      
      // åŠ è½½å¥–å“åˆ—è¡¨
      prizes = wx.getStorageSync('prizes') || [];
      const container = document.getElementById('prizesList');
      
      if (prizes.length > 0) {
        container.innerHTML = prizes.map(prize => `
          <div class="prize-item">
            <div style="display: flex; align-items: center; flex: 1;">
              <span class="prize-name">${prize.name}</span>
              <div class="prize-cost">
                <span class="cost-label">éœ€è¦</span>
                <span class="cost-stars">${prize.cost}</span>
                <span>â­</span>
              </div>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
              <button class="exchange-btn" onclick="openExchangeModal(${prize.id})" ${totalStars < prize.cost ? 'disabled' : ''}>
                å…‘æ¢
              </button>
              <button class="delete-btn" onclick="openDeleteModal(${prize.id}, '${prize.name}')">
                åˆ é™¤
              </button>
            </div>
          </div>
        `).join('');
      } else {
        container.innerHTML = '<div class="empty-record">æš‚æ— å¥–å“</div>';
      }
    }
    
    function showAddPrizeModal() {
      document.getElementById('prizeNameInput').value = '';
      document.getElementById('prizeCostInput').value = '';
      document.getElementById('addPrizeModal').style.display = 'flex';
    }
    
    function closeAddPrizeModal() {
      document.getElementById('addPrizeModal').style.display = 'none';
    }
    
    function submitAddPrize() {
      const name = document.getElementById('prizeNameInput').value.trim();
      const cost = parseInt(document.getElementById('prizeCostInput').value);
      
      if (!name) {
        wx.showToast({ title: 'è¯·è¾“å…¥å¥–å“åç§°' });
        return;
      }
      
      if (!cost || cost <= 0) {
        wx.showToast({ title: 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ˜Ÿæ˜Ÿæ•°é‡' });
        return;
      }
      
      let maxId = 0;
      prizes.forEach(prize => {
        if (prize.id > maxId) maxId = prize.id;
      });
      
      const newPrize = {
        id: maxId + 1,
        name: name,
        description: '',
        cost: cost
      };
      
      prizes.push(newPrize);
      wx.setStorageSync('prizes', prizes);
      
      wx.showToast({ title: 'æ·»åŠ æˆåŠŸ' });
      closeAddPrizeModal();
      loadPrizes();
    }
    
    function openExchangeModal(prizeId) {
      currentPrize = prizes.find(p => p.id === prizeId);
      if (!currentPrize) return;
      
      const totalStars = wx.getStorageSync('totalStars') || 0;
      if (totalStars < currentPrize.cost) {
        wx.showToast({ title: 'æ˜Ÿæ˜Ÿä¸è¶³' });
        return;
      }
      
      document.getElementById('exchangePrizeName').textContent = currentPrize.name;
      document.getElementById('exchangeCost').textContent = currentPrize.cost;
      document.getElementById('exchangeModal').style.display = 'flex';
    }
    
    function closeExchangeModal() {
      document.getElementById('exchangeModal').style.display = 'none';
      currentPrize = null;
    }
    
    function confirmExchange() {
      if (!currentPrize) return;
      
      const totalStars = wx.getStorageSync('totalStars') || 0;
      if (totalStars < currentPrize.cost) {
        wx.showToast({ title: 'æ˜Ÿæ˜Ÿä¸è¶³' });
        return;
      }
      
      // æ‰£é™¤æ˜Ÿæ˜Ÿ
      wx.setStorageSync('totalStars', totalStars - currentPrize.cost);
      
      // è®°å½•å…‘å¥–
      const now = new Date();
      const exchangeRecords = wx.getStorageSync('exchangeRecords') || [];
      exchangeRecords.push({
        id: Date.now(),
        prizeId: currentPrize.id,
        prizeName: currentPrize.name,
        cost: currentPrize.cost,
        date: now.toLocaleDateString('zh-CN'),
        time: now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })
      });
      wx.setStorageSync('exchangeRecords', exchangeRecords);
      
      wx.showToast({ title: 'å…‘æ¢æˆåŠŸ' });
      closeExchangeModal();
      loadPrizes();
    }
    
    // åˆ é™¤å¥–å“ç›¸å…³å‡½æ•°
    function openDeleteModal(prizeId, prizeName) {
      deletePrizeId = prizeId;
      document.getElementById('deletePrizeName').textContent = prizeName;
      document.getElementById('deleteModal').style.display = 'flex';
    }
    
    function closeDeleteModal() {
      document.getElementById('deleteModal').style.display = 'none';
      deletePrizeId = 0;
    }
    
    function confirmDelete() {
      if (!deletePrizeId) return;
      
      // è¿‡æ»¤æ‰è¦åˆ é™¤çš„å¥–å“
      const updatedPrizes = prizes.filter(prize => prize.id !== deletePrizeId);
      
      // æ›´æ–°æœ¬åœ°å­˜å‚¨
      wx.setStorageSync('prizes', updatedPrizes);
      
      // æ›´æ–°é¡µé¢æ•°æ®
      prizes = updatedPrizes;
      
      wx.showToast({ title: 'åˆ é™¤æˆåŠŸ' });
      closeDeleteModal();
      loadPrizes();
    }
  </script>
</body>
</html>
