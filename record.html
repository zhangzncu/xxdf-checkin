<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è®°å½• - åšæŒå¾ˆé…·</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <!-- æ¿€åŠ±è¯­ -->
    <div class="card welcome-card">
      <div class="welcome-text">å­¦ä¹ å¾ˆè‹¦</div>
      <div class="welcome-text cool-text">åšæŒå¾ˆé…·</div>
    </div>
    
    <!-- æ ‡ç­¾é€‰æ‹©å™¨ -->
    <div class="tab-bar" style="position: relative; margin-bottom: 15px; box-shadow: none; border-bottom: 1px solid #e0e0e0;">
      <div class="tab-item active" id="checkTab" onclick="switchTab('check')">
        <span class="tab-text">æ‰“å¡è®°å½•</span>
      </div>
      <div class="tab-item" id="exchangeTab" onclick="switchTab('exchange')">
        <span class="tab-text">å…‘å¥–è®°å½•</span>
      </div>
    </div>
    
    <!-- æ‰“å¡è®°å½• -->
    <div id="checkRecordsContainer" class="records-container">
      <div class="record-list" id="checkRecords">
        <div class="empty-record">æš‚æ— æ‰“å¡è®°å½•</div>
      </div>
    </div>
    
    <!-- å…‘å¥–è®°å½• -->
    <div id="exchangeRecordsContainer" style="display: none;" class="records-container">
      <div class="record-list" id="exchangeRecords">
        <div class="empty-record">æš‚æ— å…‘å¥–è®°å½•</div>
      </div>
    </div>
    
    <!-- åº•éƒ¨å¯¼èˆª -->
    <div class="tab-bar">
      <a href="index.html" class="tab-item">
        <span class="tab-icon">ğŸ </span>
        <span class="tab-text">é¦–é¡µ</span>
      </a>
      <a href="check.html" class="tab-item">
        <span class="tab-icon">âœ…</span>
        <span class="tab-text">æ‰“å¡</span>
      </a>
      <a href="record.html" class="tab-item active">
        <span class="tab-icon">ğŸ“‹</span>
        <span class="tab-text">è®°å½•</span>
      </a>
      <a href="prize.html" class="tab-item">
        <span class="tab-icon">ğŸ</span>
        <span class="tab-text">å¥–å“</span>
      </a>
      <a href="setting.html" class="tab-item">
        <span class="tab-icon">âš™ï¸</span>
        <span class="tab-text">è®¾ç½®</span>
      </a>
    </div>
  </div>
  
  <style>
    .tab-bar .tab-item { flex: 1; }
    .tab-bar .tab-item.active { color: #4CAF50; }
    .records-container { max-height: 600px; overflow-y: auto; margin-bottom: 20px; }
    .record-list { padding-bottom: 20px; }
    .record-group { margin-bottom: 15px; }
    /* æ—¥æœŸå¤´éƒ¨ */
    .date-header {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      background-color: #f0f8ff;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 10px;
      border-left: 4px solid #4CAF50;
      transition: all 0.3s ease;
    }
    .date-header:active {
      background-color: #e0f0ff;
    }
    .group-date {
      font-size: 16px;
      font-weight: bold;
      color: #333;
      margin-right: 10px;
    }
    .group-count {
      font-size: 12px;
      color: #666;
      margin-right: auto;
    }
    .toggle-icon {
      font-size: 12px;
      color: #666;
      transition: transform 0.3s ease;
    }
    /* æ—¥æœŸè®°å½•å®¹å™¨ */
    .date-records {
      padding-left: 20px;
      animation: slideDown 0.3s ease;
    }
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    /* è®°å½•é¡¹ */
    .record-item {
      display: flex;
      align-items: center;
      padding: 15px;
      border-bottom: 1px solid #f0f0f0;
      background-color: #fafafa;
      border-radius: 8px;
      margin-bottom: 10px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .record-item:active {
      background-color: #f5f5f5;
      transform: translateY(1px);
    }
    .record-name {
      flex: 1;
      font-size: 14px;
      color: #333;
      margin-right: 15px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .record-time {
      font-size: 12px;
      color: #999;
      margin-right: 15px;
      white-space: nowrap;
    }
    .record-stars {
      display: flex;
      gap: 3px;
    }
    .record-stars .star {
      font-size: 14px;
    }
    .exchange-item {
      display: flex; justify-content: space-between; align-items: center;
    }
    .cost-text { color: #f44336; font-weight: bold; }
    /* æ»šåŠ¨æ¡æ ·å¼ */
    .records-container::-webkit-scrollbar {
      width: 6px;
    }
    .records-container::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 3px;
    }
    .records-container::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 3px;
    }
    .records-container::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
  </style>
  
  <script src="wx-api.js"></script>
  <script>
    let activeTab = 'check';
    
    document.addEventListener('DOMContentLoaded', function() {
      loadRecords();
    });
    
    function switchTab(tab) {
      activeTab = tab;
      
      document.getElementById('checkTab').classList.toggle('active', tab === 'check');
      document.getElementById('exchangeTab').classList.toggle('active', tab === 'exchange');
      
      document.getElementById('checkRecordsContainer').style.display = tab === 'check' ? 'block' : 'none';
      document.getElementById('exchangeRecordsContainer').style.display = tab === 'exchange' ? 'block' : 'none';
    }
    
    function loadRecords() {
      // åŠ è½½æ‰“å¡è®°å½•
      const checkRecords = wx.getStorageSync('checkRecords') || [];
      const groupedCheckRecords = groupByDate(checkRecords);
      
      const checkContainer = document.getElementById('checkRecords');
      if (groupedCheckRecords.length > 0) {
        checkContainer.innerHTML = groupedCheckRecords.map(group => `
          <div class="record-group">
            <div class="date-header" onclick="toggleDateGroup('check-${group.date}')">
              <span class="group-date">${group.date}</span>
              <span class="group-count">(${group.records.length}é¡¹)</span>
              <span class="toggle-icon">â–¶</span>
            </div>
            <div class="date-records" id="check-${group.date}" style="display: none;">
              ${group.records.map(record => `
                <div class="card record-item">
                  <span class="record-name">${record.itemName}</span>
                  <div class="record-time">${record.time}</div>
                  <div class="record-stars">
                    ${Array(record.stars).fill('<span class="star">â­</span>').join('')}
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        `).join('');
      } else {
        checkContainer.innerHTML = '<div class="empty-record">æš‚æ— æ‰“å¡è®°å½•</div>';
      }
      
      // åŠ è½½å…‘å¥–è®°å½•
      const exchangeRecords = wx.getStorageSync('exchangeRecords') || [];
      const groupedExchangeRecords = groupByDate(exchangeRecords);
      
      const exchangeContainer = document.getElementById('exchangeRecords');
      if (groupedExchangeRecords.length > 0) {
        exchangeContainer.innerHTML = groupedExchangeRecords.map(group => `
          <div class="record-group">
            <div class="date-header" onclick="toggleDateGroup('exchange-${group.date}')">
              <span class="group-date">${group.date}</span>
              <span class="group-count">(${group.records.length}é¡¹)</span>
              <span class="toggle-icon">â–¶</span>
            </div>
            <div class="date-records" id="exchange-${group.date}" style="display: none;">
              ${group.records.map(record => `
                <div class="card record-item exchange-item">
                  <span class="record-name">${record.prizeName}</span>
                  <div class="record-time">${record.time}</div>
                  <span class="cost-text">-${record.cost}â­</span>
                </div>
              `).join('')}
            </div>
          </div>
        `).join('');
      } else {
        exchangeContainer.innerHTML = '<div class="empty-record">æš‚æ— å…‘å¥–è®°å½•</div>';
      }
    }
    
    function groupByDate(records) {
      const sorted = records.sort((a, b) => new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time));
      const grouped = {};
      
      sorted.forEach(record => {
        if (!grouped[record.date]) {
          grouped[record.date] = [];
        }
        grouped[record.date].push(record);
      });
      
      // æŒ‰æ—¥æœŸæ’åºï¼Œæœ€æ–°çš„åœ¨å‰é¢
      return Object.keys(grouped)
        .sort((a, b) => new Date(b) - new Date(a))
        .map(date => ({
          date: date,
          records: grouped[date]
        }));
    }
    
    function toggleDateGroup(groupId) {
      const element = document.getElementById(groupId);
      const icon = element.previousElementSibling.querySelector('.toggle-icon');
      if (element.style.display === 'none') {
        element.style.display = 'block';
        icon.textContent = 'â–¼';
      } else {
        element.style.display = 'none';
        icon.textContent = 'â–¶';
      }
    }
  </script>
</body>
</html>
