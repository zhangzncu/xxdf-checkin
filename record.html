<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è®°å½• - å„¿ç«¥å­¦ä¹ æ‰“å¡</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <!-- æ¿€åŠ±è¯­ -->
    <div class="card welcome-card">
      <div class="welcome-text">å­¦ä¹ å¾ˆè‹¦</div>
      <div class="welcome-text cool-text">åšæŒå¾ˆé…·</div>
    </div>
    
    <!-- æ ‡ç­¾é€‰æ‹©å™¨ -->
    <div class="tab-bar" style="position: relative; margin-bottom: 15px; box-shadow: none; border-bottom: 1px solid #e0e0e0;">
      <div class="tab-item active" id="checkTab" onclick="switchTab('check')">
        <span class="tab-text">æ‰“å¡è®°å½•</span>
      </div>
      <div class="tab-item" id="exchangeTab" onclick="switchTab('exchange')">
        <span class="tab-text">å…‘å¥–è®°å½•</span>
      </div>
    </div>
    
    <!-- æ‰“å¡è®°å½• -->
    <div id="checkRecordsContainer" class="records-container">
      <div class="record-list" id="checkRecords">
        <div class="empty-record">æš‚æ— æ‰“å¡è®°å½•</div>
      </div>
    </div>
    
    <!-- å…‘å¥–è®°å½• -->
    <div id="exchangeRecordsContainer" style="display: none;" class="records-container">
      <div class="record-list" id="exchangeRecords">
        <div class="empty-record">æš‚æ— å…‘å¥–è®°å½•</div>
      </div>
    </div>
    
    <!-- åº•éƒ¨å¯¼èˆª -->
    <div class="tab-bar">
      <a href="index.html" class="tab-item">
        <span class="tab-icon">ğŸ </span>
        <span class="tab-text">é¦–é¡µ</span>
      </a>
      <a href="check.html" class="tab-item">
        <span class="tab-icon">âœ…</span>
        <span class="tab-text">æ‰“å¡</span>
      </a>
      <a href="record.html" class="tab-item active">
        <span class="tab-icon">ğŸ“‹</span>
        <span class="tab-text">è®°å½•</span>
      </a>
      <a href="prize.html" class="tab-item">
        <span class="tab-icon">ğŸ</span>
        <span class="tab-text">å¥–å“</span>
      </a>
      <a href="setting.html" class="tab-item">
        <span class="tab-icon">âš™ï¸</span>
        <span class="tab-text">è®¾ç½®</span>
      </a>
    </div>
  </div>
  
  <style>
    .tab-bar .tab-item { flex: 1; }
    .tab-bar .tab-item.active { color: #4CAF50; }
    .records-container { max-height: 500px; overflow-y: auto; margin-bottom: 20px; }
    .record-list { padding-bottom: 20px; }
    .record-group { margin-bottom: 20px; }
    .group-date { font-size: 12px; color: #999; margin-bottom: 10px; display: block; }
    .exchange-item { display: flex; justify-content: space-between; align-items: center; }
    .cost-text { color: #f44336; font-weight: bold; }
    /* æ»šåŠ¨æ¡æ ·å¼ */
    .records-container::-webkit-scrollbar {
      width: 6px;
    }
    .records-container::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 3px;
    }
    .records-container::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 3px;
    }
    .records-container::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
  </style>
  
  <script src="wx-api.js"></script>
  <script>
    let activeTab = 'check';
    
    document.addEventListener('DOMContentLoaded', function() {
      loadRecords();
    });
    
    function switchTab(tab) {
      activeTab = tab;
      
      document.getElementById('checkTab').classList.toggle('active', tab === 'check');
      document.getElementById('exchangeTab').classList.toggle('active', tab === 'exchange');
      
      document.getElementById('checkRecordsContainer').style.display = tab === 'check' ? 'block' : 'none';
      document.getElementById('exchangeRecordsContainer').style.display = tab === 'exchange' ? 'block' : 'none';
    }
    
    function loadRecords() {
      // åŠ è½½æ‰“å¡è®°å½•
      const checkRecords = wx.getStorageSync('checkRecords') || [];
      const groupedCheckRecords = groupByDate(checkRecords);
      
      const checkContainer = document.getElementById('checkRecords');
      if (groupedCheckRecords.length > 0) {
        checkContainer.innerHTML = groupedCheckRecords.map(group => `
          <div class="record-group">
            <span class="group-date">${group.date}</span>
            ${group.records.map(record => `
              <div class="card record-item">
                <span class="record-name">${record.itemName}</span>
                <div class="record-stars">
                  ${Array(record.stars).fill('<span class="star">â­</span>').join('')}
                </div>
              </div>
            `).join('')}
          </div>
        `).join('');
      } else {
        checkContainer.innerHTML = '<div class="empty-record">æš‚æ— æ‰“å¡è®°å½•</div>';
      }
      
      // åŠ è½½å…‘å¥–è®°å½•
      const exchangeRecords = wx.getStorageSync('exchangeRecords') || [];
      const groupedExchangeRecords = groupByDate(exchangeRecords);
      
      const exchangeContainer = document.getElementById('exchangeRecords');
      if (groupedExchangeRecords.length > 0) {
        exchangeContainer.innerHTML = groupedExchangeRecords.map(group => `
          <div class="record-group">
            <span class="group-date">${group.date}</span>
            ${group.records.map(record => `
              <div class="card record-item exchange-item">
                <span class="record-name">${record.prizeName}</span>
                <span class="cost-text">-${record.cost}â­</span>
              </div>
            `).join('')}
          </div>
        `).join('');
      } else {
        exchangeContainer.innerHTML = '<div class="empty-record">æš‚æ— å…‘å¥–è®°å½•</div>';
      }
    }
    
    function groupByDate(records) {
      const sorted = records.sort((a, b) => new Date(b.date) - new Date(a.date));
      const grouped = {};
      
      sorted.forEach(record => {
        if (!grouped[record.date]) {
          grouped[record.date] = [];
        }
        grouped[record.date].push(record);
      });
      
      return Object.keys(grouped).map(date => ({
        date: date,
        records: grouped[date]
      }));
    }
  </script>
</body>
</html>
